---
title: "SQLã§ã€Œè·é›¢ã€ãŒè¿‘ã„æ–‡å­—åˆ—ã‚’æ±‚ã‚ã‚‹"
emoji: "ğŸ‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
tags: ["SQL"]
published: true
published_at: 2023-10-22 21:00
---

# ã‚„ã‚ŠãŸã„ã“ã¨

ã‚ã‚‹æ–‡å­—åˆ—ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãã€ãã®æ–‡å­—åˆ—ã‹ã‚‰ä¸€ç•ªè¿‘ã„ã€Œè·é›¢ã€ã®æ–‡å­—åˆ—ã‚’ SQL ã§å–å¾—ã—ãŸã„ã€‚

ä¾‹ãˆã°ã€æ—¥æœ¬ã®éƒµä¾¿ç•ªå·ã¯ã€Œ000-0000ã€ã®ã‚ˆã†ãªãƒã‚¤ãƒ•ãƒ³ä»˜ãã® 7 æ¡ã®æ•°å­—ã§ç®¡ç†ã•ã‚Œã¦ãŠã‚Šã€2 ã¤ã®ç•°ãªã‚‹éƒµä¾¿ç•ªå·ã¯ä¸‹ä½ã®æ¡ã¾ã§ä¸€è‡´ã™ã‚‹ã»ã©è¿‘ã„åœ°åŸŸã®éƒµä¾¿ç•ªå·ã‚’è¡¨ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚ã£ãŸã¨ãã€éƒµä¾¿ç•ªå· ã€Œ4130033ã€ã«å¯¾ã—ã¦ã€ã€Œæœ€å¯„ã‚Šã€ã®éƒµä¾¿ç•ªå·ã‚’ SQL ã§å–å¾—ã—ãŸã„ã€‚

```sql:ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
create table postal_code (
  pcode char(7),
  district_name varchar(256),
  constraint pk_code primary key(pcode)
);

insert into postal_code values
('4130001', 'A'),
('4130002', 'B'),
('4130103', 'C'),
('4130041', 'D'),
('4103213', 'E'),
('4380824', 'F');

-- æ±‚ã‚ã‚‹çµæœ
-- pcode
-- -------
-- 4130001
-- 4130002
-- 4130041
```

# å›ç­”

```sql:å›ç­”
select
  pcode,
  district_name
from postal_code
where case when pcode = '4130033' then 0
      when pcode like '413003%' then 1
      when pcode like '41300%' then 2
      when pcode like '4130%' then 3
      when pcode like '413%' then 4
      when pcode like '41%' then 5
      when pcode like '4%' then 6
      else null end = (
        select min(
          case when pcode = '4130033' then 0
              when pcode like '413003%' then 1
              when pcode like '41300%' then 2
              when pcode like '4130%' then 3
              when pcode like '413%' then 4
              when pcode like '41%' then 5
              when pcode like '4%' then 6
              else null end
        )
        from postal_code
      );
```

```sql:åˆ¥è§£
select
  pcode,
  district_name
from (
  select
    pcode,
    district_name,
    case when pcode = '4130033' then 0
        when pcode like '413003%' then 1
        when pcode like '41300%' then 2
        when pcode like '4130%' then 3
        when pcode like '413%' then 4
        when pcode like '41%' then 5
        when pcode like '4%' then 6
        else null end as distance,
    min(
      case when pcode = '4130033' then 0
          when pcode like '413003%' then 1
          when pcode like '41300%' then 2
          when pcode like '4130%' then 3
          when pcode like '413%' then 4
          when pcode like '41%' then 5
          when pcode like '4%' then 6
          else null
    ) over (
      order by case when pcode = '4130033' then 0
        when pcode like '413003%' then 1
        when pcode like '41300%' then 2
        when pcode like '4130%' then 3
        when pcode like '413%' then 4
        when pcode like '41%' then 5
        when pcode like '4%' then 6
        else null end
    ) as min_distance
  from postal_code
) tmp
where distance = min_distance;
```

# å‚è€ƒ

https://amzn.to/45HPa6s
