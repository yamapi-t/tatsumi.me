---
title: "ã€Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã¾ã¨ã‚ã€ã‚’ãªãã‚‹"
emoji: "ğŸ™„"
type: "tech"
tags:
  - "Next.js"
  - "TypeScript"
published: true
published_at: "2022-12-15 19:44"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ qiita ã‹ã‚‰ç§»è¡Œã—ãŸã‚‚ã®ã§ã™ã€‚

å‹‰å¼·ã¨ã—ã¦ä»¥ä¸‹ã®è¨˜äº‹ã‚’ãªãã£ãŸã®ã§è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚ã¨ã“ã‚ã©ã“ã‚è‡ªå·±æµã«ã‚¢ãƒ¬ãƒ³ã‚¸ã—ã¦ã„ã¾ã™ã€‚

https://qiita.com/KNR109/items/7cf6b24bed318dab5715

# ç’°å¢ƒæ§‹ç¯‰

ç’°å¢ƒæ§‹ç¯‰ãŒå…ƒè¨˜äº‹ã¨é•ã„ã¾ã™ã€‚
ä»¥ä¸‹ã§ã¯ã€[Next.js ã®å…¬å¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](https://nextjs.org/docs/testing)ã¨[React-Testing-Library å…¬å¼ã® userEvent ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®è¨˜äº‹](https://testing-library.com/docs/user-event/install)ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

```bash:ç’°å¢ƒæ§‹ç¯‰
# ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã€Œtest-turorialã€ã¨ã„ã†åå‰ã§next.jsã‚¢ãƒ—ãƒªã‚’ä½œæˆ
npx create-next-app --ts --use-npm test-tutorial

# ã„ã¾ä½œã£ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd test-tutorial

# ä»Šå›ä½¿ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm i jest jest-environment-jsdom @testing-library/react @testing-library/jest-domã€€@testing-library/user-eventã€€msw axios
```

ã•ã‚‰ã«ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« jest.config.js ã‚’ä½œæˆã—ã¦ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚

```js:jest.confing.js
const nextJest = require('next/jest')

const createJestConfig = nextJest({
  // ãƒ†ã‚¹ãƒˆç’°å¢ƒã®next.config.jsã¨.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã«ã€Next.jsã‚¢ãƒ—ãƒªã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¾ã™
  dir: './',
})

// jestã«æ¸¡ã•ã‚Œã‚‹ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’è¿½åŠ ã—ã¾ã™
const customJestConfig = {
  // å„ãƒ†ã‚¹ãƒˆãŒèµ°ã‚‹å‰ã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã™
  // setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  // TypeScriptã§baseUrlã‚’ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¨­å®šã—ã¦ã„ã‚‹å ´åˆã€aliasã‚’å‹•ä½œã•ã›ã‚‹ãŸã‚ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
  moduleDirectories: ['node_modules', '<rootDir>/'],
  testEnvironment: 'jest-environment-jsdom',
}

// createJestConfigã¯ã€next/jestãŒéåŒæœŸã§Next.jsã®è¨­å®šã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€ã“ã®ã‚ˆã†ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚
module.exports = createJestConfig(customJestConfig)
```

package.json ã« npm script ã‚’è¿½åŠ ã—ã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œnpm run testã€ã§ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã§ãã¾ã™ã€‚

```diff:package.json
...

"scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
+   "test": "jest --verbose"
  },

...
```

# ãƒ†ã‚¹ãƒˆ

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ

```tsx:pages/index.tsx
import type { NextPage } from "next";

const Home: NextPage = () => {
  return <div>Hello World</div>;
};
export default Home;
```

```tsx:__tests__/index.test.tsx
import { render, screen } from "@testing-library/react";
import Home from "../pages";
import "@testing-library/jest-dom/extend-expect";

describe("ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ", () => {
  it("ç”»é¢ã«Hello WorldãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨", () => {
    render(<Home />);
    expect(screen.getByText("Hello World")).toBeInTheDocument();
  });
});
```

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

```tsx:components/searchForm.tsx
import React, { useState } from "react";

export const SearchForm = (): JSX.Element => {
  const [value, setValue] = useState<string>("");
  const onchange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setValue(e.target.value);
  };

  const onClick = () => {
    // æ¤œç´¢ã®å‡¦ç†
  };
  return (
    <div>
      <input type="text" onChange={onchange} value={value} />
      <button onClick={onClick}>æ¤œç´¢</button>
    </div>
  );
};
```

```tsx:__tests__/searchForm.test_tsx
import { render, screen } from "@testing-library/react";
import { SearchForm } from "../components/searchForm";
import userEvent from "@testing-library/user-event";
import "@testing-library/jest-dom/extend-expect";

describe("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ", () => {
  it("ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’å…¥åŠ›ã—ãŸã¨ãã«ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ãŒå…¥åŠ›ã—ãŸå€¤ã«ãªã£ã¦ã„ã‚‹ã“ã¨", async () => {
    render(<SearchForm />);
    const inputForm = screen.getByRole("textbox") as HTMLInputElement;
    // userEvent.typeã¯è¿”ã‚Šå€¤ãŒPromiseå‹ãªã®ã§awaitã‚’ã¤ã‘ã‚‹
    await userEvent.type(inputForm, "test");
    expect(inputForm.value).toBe("test");
  });
});
```

## props ã§ã®ãƒ‡ãƒ¼ã‚¿å—ã‘å–ã‚Šã®ãƒ†ã‚¹ãƒˆ

```tsx:components/cards.tsx
type User = {
  id: number;
  name: string;
};

export const Cards = ({ userInfos }: { userInfos: User[] }): JSX.Element => {
  return (
    <>
      {userInfos.length === 0 ? (
        <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯0ã§ã™</p>
      ) : (
        <ul>
          {userInfos.map((userInfo) => {
            return (
              <li key={userInfo.id}>
                id:{userInfo.id} name:{userInfo.name}
              </li>
            );
          })}
        </ul>
      )}
    </>
  );
};
```

```tsx:__tests__/cards.tsx
import { render, screen } from "@testing-library/react";
import { Cards } from "../components/Cards";
import "@testing-library/jest-dom/extend-expect";

describe("propsã§ã®ãƒ‡ãƒ¼ã‚¿å—ã‘å–ã‚Šã®ãƒ†ã‚¹ãƒˆ", () => {
  it("ç©ºé…åˆ—ã‚’æ¸¡ã—ãŸã¨ãã«ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯0ã§ã™ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨", () => {
    render(<Cards userInfos={[]} />);
    expect(screen.getByText("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¯0ã§ã™")).toBeInTheDocument();
  });

  it("ç©ºã§ãªã„é…åˆ—ã‚’æ¸¡ã—ãŸã¨ãã«æ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨", () => {
    const dummyUserInfos = [
      { id: 1, name: "tom" },
      { id: 2, name: "mary" },
      { id: 3, name: "bob" },
    ];
    render(<Cards userInfos={dummyUserInfos} />);

    const userInfos = screen
      .getAllByRole("listitem")
      .map((item) => item.textContent);
    const dummyItems = dummyUserInfos.map(
      (item) => `id:${item.id} name:${item.name}`
    );

    expect(userInfos).toEqual(dummyItems);
  });
});

```

## useEffect ã®ãƒ†ã‚¹ãƒˆ

```tsx:pages/blog.tsx
import axios from "axios";
import { NextPage } from "next";
import { useEffect, useState } from "react";

type Post = {
  userId: number;
  id: number;
  title: string;
  body: string;
};

const BlogPage: NextPage = () => {
  const [postData, setPostData] = useState<Post>();

  const getPost = async (): Promise<Post> => {
    const response = await axios.get(
      "https://jsonplaceholder.typicode.com/posts/1"
    );

    return response.data;
  };

  useEffect(() => {
    try {
      const getData = async () => {
        const result = await getPost();
        setPostData(result);
      };
      getData();
    } catch (e: unknown) {
      console.log(e);
    }
  }, []);

  return (
    <div>
      {!postData ? (
        <p>ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­</p>
      ) : (
        <p>
          è¨˜äº‹ID{postData.id}:{postData.title}
        </p>
      )}
    </div>
  );
};

export default BlogPage;
```

```tsx:__tests__/blog.test.tsx
import { render, screen } from "@testing-library/react";
import BlogPage from "../pages/blog";
import "@testing-library/jest-dom/extend-expect";

describe("useEffectã®ãƒ†ã‚¹ãƒˆ", () => {
  it("ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†å‰ã«ã¯ã€Œãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨", () => {
    render(<BlogPage />);
    expect(screen.getByText("ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­")).toBeInTheDocument();
  });

  it("ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†å¾Œã¯ã€Œè¨˜äº‹IDã€ã‚’å«ã‚€ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨", async () => {
    render(<BlogPage />);
    expect(await screen.findByText(/è¨˜äº‹ID/)).toBeInTheDocument();
  });
});
```

## API ã®ãƒ†ã‚¹ãƒˆ

```tsx:pages/user.tsx
import axios from "axios";
import { NextPage } from "next";
import { useState } from "react";

type User = {
  id: number;
  name: string;
  username: string;
  email: string;
};
const UserPage: NextPage = () => {
  const [user, setUser] = useState<User>();
  const [error, setError] = useState<string>("");

  const getUser = async () => {
    try {
      const response = await axios.get(
        "https://jsonplaceholder.typicode.com/users/1"
      );
      const { id, name, username, email } = response.data;
      const userInfo = {
        id,
        name,
        username,
        email,
      };
      setUser(userInfo);
    } catch (e: unknown) {
      setError("Request failed.");
    }
  };

  return (
    <div>
      {!user && !error && (
        <>
          <p>ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</p>
          <button onClick={getUser}>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—</button>
        </>
      )}
      {user && <h3>åå‰: {user.name}</h3>}
      {error && <p data-testid="error">{error}</p>}
    </div>
  );
};

export default UserPage;
```

```tsx:__tests__/user.test.tsx
import { render, screen } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import { rest } from "msw";
import { setupServer } from "msw/node";
import UserPage from "../pages/user";

const server = setupServer(
  rest.get("https://jsonplaceholder.typicode.com/users/1", (_req, res, ctx) => {
    return res(
      ctx.status(200),
      ctx.json({
        id: 1,
        name: "Leanne Graham dummy",
        username: "Bret dummy",
        email: "Sincere@april.biz.dummy",
      })
    );
  })
);

beforeAll(() => server.listen());
afterEach(() => {
  server.resetHandlers();
});
afterAll(() => server.close());

describe("APIã®ãƒ†ã‚¹ãƒˆ", () => {
  it("ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ããŸéš›ã«æ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨", async () => {
    render(<UserPage />);
    await userEvent.click(screen.getByRole("button"));
    expect((await screen.findByRole("heading")).textContent).toEqual(
      "åå‰: Leanne Graham dummy"
    );
  });

  it("ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ããªã‹ã£ãŸéš›ã«ã€ŒRequest failed.ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨", async () => {
    server.use(
      rest.get(
        "https://jsonplaceholder.typicode.com/users/1",
        (_req, res, ctx) => {
          return res.once(ctx.status(404), ctx.json({ message: "error" }));
        }
      )
    );

    render(<UserPage />);
    await userEvent.click(screen.getByRole("button"));
    expect((await screen.findByTestId("error")).textContent).toEqual(
      "Request failed."
    );
    expect(screen.queryByRole("heading")).toBeNull();
  });
});

```
